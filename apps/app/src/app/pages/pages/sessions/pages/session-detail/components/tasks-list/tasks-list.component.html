<clr-datagrid
  (clrDgRefresh)="refresh.emit($event)"
  [clrDgLoading]="loading"
  [clrDgSelected]="selection"
  (clrDgSelectedChange)="selectionChange.emit($event)"
>
  <clr-dg-action-bar>
    <div class="btn-group">
      <button
        type="button"
        class="btn btn-sm btn-secondary"
        (click)="cancelTasksChange.emit()"
        [clrLoading]="cancelButtonState"
      >
        {{ 'pages.sessions.session-detail.table.cancel' | translate }}
      </button>
    </div>
  </clr-dg-action-bar>

  <clr-dg-column>
    {{ 'pages.sessions.session-detail.table.id' | translate }}
  </clr-dg-column>
  <clr-dg-column clrDgField="StartDate">
    {{ 'pages.sessions.session-detail.table.started_at' | translate }}
  </clr-dg-column>
  <clr-dg-column clrDgField="EndDate">
    {{ 'pages.sessions.session-detail.table.ended_at' | translate }}
  </clr-dg-column>
  <clr-dg-column clrDgField="Status">
    {{ 'pages.sessions.session-detail.table.status.title' | translate }}
  </clr-dg-column>
  <clr-dg-column>
    {{ 'pages.sessions.session-detail.table.detail' | translate }}
  </clr-dg-column>

  <clr-dg-row
    *ngFor="let task of tasks?.data ?? []"
    [clrDgItem]="task"
    [ngForTrackBy]="trackByTask"
  >
    <clr-dg-cell>
      <a [routerLink]="['tasks', task._id]">
        <span>
          {{ task._id }}
        </span>
      </a>
    </clr-dg-cell>
    <clr-dg-cell>
      <span>
        {{ (task.startedAt | date: 'medium') ?? '-' }}
      </span>
    </clr-dg-cell>
    <clr-dg-cell>
      <span>
        {{ (task.endedAt | date: 'medium') ?? '-' }}
      </span>
    </clr-dg-cell>
    <clr-dg-cell>
      <span class="text-danger" *ngIf="isError(task)">
        {{ 'pages.sessions.session-detail.table.status.error' | translate }}
      </span>
      <span class="text-pending" *ngIf="isPending(task)">
        {{ 'pages.sessions.session-detail.table.status.pending' | translate }}
      </span>
      <span class="text-warn" *ngIf="isProcessing(task)">
        {{
          'pages.sessions.session-detail.table.status.processing' | translate
        }}
      </span>
      <span class="text-warn" *ngIf="isCanceled(task)">
        {{ 'pages.sessions.session-detail.table.status.canceled' | translate }}
      </span>
      <span class="text-success" *ngIf="isCompleted(task)">
        {{ 'pages.sessions.session-detail.table.status.completed' | translate }}
      </span>
      <span
        *ngIf="
          !isError(task) &&
          !isPending(task) &&
          !isProcessing(task) &&
          !isCanceled(task) &&
          !isCompleted(task)
        "
      >
        -
      </span>
    </clr-dg-cell>
    <clr-dg-cell>
      <button
        class="btn-detail btn btn-sm"
        [disabled]="!isError(task)"
        (click)="openModal(task)"
      >
        {{ 'pages.sessions.session-detail.table.see-more' | translate }}
      </button>
    </clr-dg-cell>
  </clr-dg-row>

  <clr-dg-footer>
    <clr-dg-pagination #pagination [clrDgTotalItems]="totalTasks">
      <clr-dg-page-size [clrPageSizeOptions]="[10, 20, 50, 100]">{{
        'pages.sessions.session-detail.table.per_page' | translate
      }}</clr-dg-page-size>
      {{
        (totalTasks > 1
          ? 'pages.sessions.session-detail.table.tasks'
          : 'pages.sessions.session-detail.table.task'
        ) | translate: { value: totalTasks }
      }}
    </clr-dg-pagination>
  </clr-dg-footer>
</clr-datagrid>

<clr-modal [(clrModalOpen)]="isModalOpen">
  <h3 class="modal-title">
    {{
      'pages.sessions.session-detail.modal.title'
        | translate: { id: activeTask?._id }
    }}
  </h3>
  <pre class="modal-body">{{ activeTask?.output?.error }}</pre>
</clr-modal>
